Loading pipeline components...:   0%|          | 0/7 [00:00<?, ?it/s]Loading pipeline components...:  43%|████▎     | 3/7 [00:00<00:00,  8.11it/s]Loading pipeline components...:  71%|███████▏  | 5/7 [00:01<00:00,  4.08it/s]Loading pipeline components...: 100%|██████████| 7/7 [00:01<00:00,  5.96it/s]
/home/s1/eugenebaek/anaconda3/envs/masa/lib/python3.8/site-packages/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion.py:201: FutureWarning: The configuration file of this scheduler: DDIMScheduler {
  "_class_name": "DDIMScheduler",
  "_diffusers_version": "0.30.3",
  "beta_end": 0.012,
  "beta_schedule": "scaled_linear",
  "beta_start": 0.00085,
  "clip_sample": false,
  "clip_sample_range": 1.0,
  "dynamic_thresholding_ratio": 0.995,
  "num_train_timesteps": 1000,
  "prediction_type": "epsilon",
  "rescale_betas_zero_snr": false,
  "sample_max_value": 1.0,
  "set_alpha_to_one": false,
  "steps_offset": 0,
  "thresholding": false,
  "timestep_spacing": "leading",
  "trained_betas": null
}
 is outdated. `steps_offset` should be set to 1 instead of 0. Please make sure to update the config accordingly as leaving `steps_offset` might led to incorrect results in future versions. If you have downloaded this checkpoint from the Hugging Face Hub, it would be very nice if you could open a Pull request for the `scheduler/scheduler_config.json` file
  deprecate("steps_offset!=1", "1.0.0", deprecation_message, standard_warn=False)
Editing from 13668!
input text embeddings : torch.Size([1, 77, 768])
latents shape:  torch.Size([1, 4, 64, 64])
Valid timesteps:  tensor([  1,  21,  41,  61,  81, 101, 121, 141, 161, 181, 201, 221, 241, 261,
        281, 301, 321, 341, 361, 381, 401, 421, 441, 461, 481, 501, 521, 541,
        561, 581, 601, 621, 641, 661, 681, 701, 721, 741, 761, 781, 801, 821,
        841, 861, 881, 901, 921, 941, 961, 981])
DDIM Inversion:   0%|          | 0/50 [00:00<?, ?it/s]DDIM Inversion:   4%|▍         | 2/50 [00:00<00:04, 11.91it/s]DDIM Inversion:   8%|▊         | 4/50 [00:00<00:05,  9.16it/s]DDIM Inversion:  10%|█         | 5/50 [00:00<00:05,  8.74it/s]DDIM Inversion:  12%|█▏        | 6/50 [00:00<00:05,  8.46it/s]DDIM Inversion:  14%|█▍        | 7/50 [00:00<00:05,  8.28it/s]DDIM Inversion:  16%|█▌        | 8/50 [00:00<00:05,  8.16it/s]DDIM Inversion:  18%|█▊        | 9/50 [00:01<00:05,  8.07it/s]DDIM Inversion:  20%|██        | 10/50 [00:01<00:04,  8.02it/s]DDIM Inversion:  22%|██▏       | 11/50 [00:01<00:04,  7.98it/s]DDIM Inversion:  24%|██▍       | 12/50 [00:01<00:04,  7.94it/s]DDIM Inversion:  26%|██▌       | 13/50 [00:01<00:04,  7.92it/s]DDIM Inversion:  28%|██▊       | 14/50 [00:01<00:04,  7.91it/s]DDIM Inversion:  30%|███       | 15/50 [00:01<00:04,  7.90it/s]DDIM Inversion:  32%|███▏      | 16/50 [00:01<00:04,  7.89it/s]DDIM Inversion:  34%|███▍      | 17/50 [00:02<00:04,  7.88it/s]DDIM Inversion:  36%|███▌      | 18/50 [00:02<00:04,  7.88it/s]DDIM Inversion:  38%|███▊      | 19/50 [00:02<00:03,  7.88it/s]DDIM Inversion:  40%|████      | 20/50 [00:02<00:03,  7.87it/s]DDIM Inversion:  42%|████▏     | 21/50 [00:02<00:03,  7.87it/s]DDIM Inversion:  44%|████▍     | 22/50 [00:02<00:03,  7.87it/s]DDIM Inversion:  46%|████▌     | 23/50 [00:02<00:03,  7.87it/s]DDIM Inversion:  48%|████▊     | 24/50 [00:02<00:03,  7.87it/s]DDIM Inversion:  50%|█████     | 25/50 [00:03<00:03,  7.87it/s]DDIM Inversion:  52%|█████▏    | 26/50 [00:03<00:03,  7.87it/s]DDIM Inversion:  54%|█████▍    | 27/50 [00:03<00:02,  7.86it/s]DDIM Inversion:  56%|█████▌    | 28/50 [00:03<00:02,  7.85it/s]DDIM Inversion:  58%|█████▊    | 29/50 [00:03<00:02,  7.85it/s]DDIM Inversion:  60%|██████    | 30/50 [00:03<00:02,  7.85it/s]DDIM Inversion:  62%|██████▏   | 31/50 [00:03<00:02,  7.84it/s]DDIM Inversion:  64%|██████▍   | 32/50 [00:03<00:02,  7.85it/s]DDIM Inversion:  66%|██████▌   | 33/50 [00:04<00:02,  7.84it/s]DDIM Inversion:  68%|██████▊   | 34/50 [00:04<00:02,  7.84it/s]DDIM Inversion:  70%|███████   | 35/50 [00:04<00:01,  7.84it/s]DDIM Inversion:  72%|███████▏  | 36/50 [00:04<00:01,  7.84it/s]DDIM Inversion:  74%|███████▍  | 37/50 [00:04<00:01,  7.84it/s]DDIM Inversion:  76%|███████▌  | 38/50 [00:04<00:01,  7.84it/s]DDIM Inversion:  78%|███████▊  | 39/50 [00:04<00:01,  7.84it/s]DDIM Inversion:  80%|████████  | 40/50 [00:05<00:01,  7.83it/s]DDIM Inversion:  82%|████████▏ | 41/50 [00:05<00:01,  7.84it/s]DDIM Inversion:  84%|████████▍ | 42/50 [00:05<00:01,  7.84it/s]DDIM Inversion:  86%|████████▌ | 43/50 [00:05<00:00,  7.84it/s]DDIM Inversion:  88%|████████▊ | 44/50 [00:05<00:00,  7.83it/s]DDIM Inversion:  90%|█████████ | 45/50 [00:05<00:00,  7.83it/s]DDIM Inversion:  92%|█████████▏| 46/50 [00:05<00:00,  7.83it/s]DDIM Inversion:  94%|█████████▍| 47/50 [00:05<00:00,  7.84it/s]DDIM Inversion:  96%|█████████▌| 48/50 [00:06<00:00,  7.84it/s]DDIM Inversion:  98%|█████████▊| 49/50 [00:06<00:00,  7.84it/s]DDIM Inversion: 100%|██████████| 50/50 [00:06<00:00,  7.84it/s]DDIM Inversion: 100%|██████████| 50/50 [00:06<00:00,  7.96it/s]
/home/s1/eugenebaek/EditBench_eugene/MasaCtrl/masactrl/diffuser_utils.py:139: FutureWarning: Accessing config attribute `in_channels` directly via 'UNet2DConditionModel' object attribute is deprecated. Please access 'in_channels' over 'UNet2DConditionModel's config object instead, e.g. 'unet.config.in_channels'.
  latents_shape = (batch_size, self.unet.in_channels, height//8, width//8)
input text embeddings : torch.Size([1, 77, 768])
latents shape:  torch.Size([1, 4, 64, 64])
DDIM Sampler:   0%|          | 0/50 [00:00<?, ?it/s]DDIM Sampler:   4%|▍         | 2/50 [00:00<00:04, 10.76it/s]DDIM Sampler:   8%|▊         | 4/50 [00:00<00:05,  8.28it/s]DDIM Sampler:  10%|█         | 5/50 [00:00<00:05,  7.90it/s]DDIM Sampler:  12%|█▏        | 6/50 [00:00<00:05,  7.65it/s]DDIM Sampler:  14%|█▍        | 7/50 [00:00<00:05,  7.49it/s]DDIM Sampler:  16%|█▌        | 8/50 [00:01<00:05,  7.37it/s]DDIM Sampler:  18%|█▊        | 9/50 [00:01<00:05,  7.29it/s]DDIM Sampler:  20%|██        | 10/50 [00:01<00:05,  7.24it/s]DDIM Sampler:  22%|██▏       | 11/50 [00:01<00:05,  7.21it/s]DDIM Sampler:  24%|██▍       | 12/50 [00:01<00:05,  7.18it/s]DDIM Sampler:  26%|██▌       | 13/50 [00:01<00:05,  7.17it/s]DDIM Sampler:  28%|██▊       | 14/50 [00:01<00:05,  7.15it/s]DDIM Sampler:  30%|███       | 15/50 [00:02<00:04,  7.15it/s]DDIM Sampler:  32%|███▏      | 16/50 [00:02<00:04,  7.14it/s]DDIM Sampler:  34%|███▍      | 17/50 [00:02<00:04,  7.14it/s]DDIM Sampler:  36%|███▌      | 18/50 [00:02<00:04,  7.13it/s]DDIM Sampler:  38%|███▊      | 19/50 [00:02<00:04,  7.14it/s]DDIM Sampler:  40%|████      | 20/50 [00:02<00:04,  7.13it/s]DDIM Sampler:  42%|████▏     | 21/50 [00:02<00:04,  7.13it/s]DDIM Sampler:  44%|████▍     | 22/50 [00:02<00:03,  7.14it/s]DDIM Sampler:  46%|████▌     | 23/50 [00:03<00:03,  7.14it/s]DDIM Sampler:  48%|████▊     | 24/50 [00:03<00:03,  7.13it/s]DDIM Sampler:  50%|█████     | 25/50 [00:03<00:03,  7.13it/s]DDIM Sampler:  52%|█████▏    | 26/50 [00:03<00:03,  7.13it/s]DDIM Sampler:  54%|█████▍    | 27/50 [00:03<00:03,  7.13it/s]DDIM Sampler:  56%|█████▌    | 28/50 [00:03<00:03,  7.12it/s]DDIM Sampler:  58%|█████▊    | 29/50 [00:03<00:02,  7.12it/s]DDIM Sampler:  60%|██████    | 30/50 [00:04<00:02,  7.12it/s]DDIM Sampler:  62%|██████▏   | 31/50 [00:04<00:02,  7.13it/s]DDIM Sampler:  64%|██████▍   | 32/50 [00:04<00:02,  7.15it/s]DDIM Sampler:  66%|██████▌   | 33/50 [00:04<00:02,  7.15it/s]DDIM Sampler:  68%|██████▊   | 34/50 [00:04<00:02,  7.16it/s]DDIM Sampler:  70%|███████   | 35/50 [00:04<00:02,  7.16it/s]DDIM Sampler:  72%|███████▏  | 36/50 [00:04<00:01,  7.16it/s]DDIM Sampler:  74%|███████▍  | 37/50 [00:05<00:01,  7.16it/s]DDIM Sampler:  76%|███████▌  | 38/50 [00:05<00:01,  7.16it/s]DDIM Sampler:  78%|███████▊  | 39/50 [00:05<00:01,  7.17it/s]DDIM Sampler:  80%|████████  | 40/50 [00:05<00:01,  7.16it/s]DDIM Sampler:  82%|████████▏ | 41/50 [00:05<00:01,  7.16it/s]DDIM Sampler:  84%|████████▍ | 42/50 [00:05<00:01,  7.16it/s]DDIM Sampler:  86%|████████▌ | 43/50 [00:05<00:00,  7.16it/s]DDIM Sampler:  88%|████████▊ | 44/50 [00:06<00:00,  7.15it/s]DDIM Sampler:  90%|█████████ | 45/50 [00:06<00:00,  7.15it/s]DDIM Sampler:  92%|█████████▏| 46/50 [00:06<00:00,  7.15it/s]DDIM Sampler:  94%|█████████▍| 47/50 [00:06<00:00,  7.15it/s]DDIM Sampler:  96%|█████████▌| 48/50 [00:06<00:00,  7.15it/s]DDIM Sampler:  98%|█████████▊| 49/50 [00:06<00:00,  7.15it/s]DDIM Sampler: 100%|██████████| 50/50 [00:06<00:00,  7.15it/s]DDIM Sampler: 100%|██████████| 50/50 [00:06<00:00,  7.24it/s]
MasaCtrl at denoising steps:  [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49]
MasaCtrl at U-Net layers:  [10, 11, 12, 13, 14, 15]
input text embeddings : torch.Size([2, 77, 768])
latents shape:  torch.Size([2, 4, 64, 64])
DDIM Sampler:   0%|          | 0/50 [00:00<?, ?it/s]DDIM Sampler:   4%|▍         | 2/50 [00:00<00:08,  5.80it/s]DDIM Sampler:   6%|▌         | 3/50 [00:00<00:09,  4.79it/s]DDIM Sampler:   8%|▊         | 4/50 [00:00<00:10,  4.39it/s]DDIM Sampler:  10%|█         | 5/50 [00:01<00:10,  4.16it/s]DDIM Sampler:  12%|█▏        | 6/50 [00:01<00:11,  3.81it/s]DDIM Sampler:  14%|█▍        | 7/50 [00:01<00:11,  3.61it/s]DDIM Sampler:  16%|█▌        | 8/50 [00:02<00:12,  3.49it/s]DDIM Sampler:  18%|█▊        | 9/50 [00:02<00:12,  3.41it/s]DDIM Sampler:  20%|██        | 10/50 [00:02<00:11,  3.36it/s]DDIM Sampler:  22%|██▏       | 11/50 [00:02<00:11,  3.33it/s]DDIM Sampler:  24%|██▍       | 12/50 [00:03<00:11,  3.30it/s]DDIM Sampler:  26%|██▌       | 13/50 [00:03<00:11,  3.28it/s]DDIM Sampler:  28%|██▊       | 14/50 [00:03<00:10,  3.27it/s]DDIM Sampler:  30%|███       | 15/50 [00:04<00:10,  3.26it/s]DDIM Sampler:  32%|███▏      | 16/50 [00:04<00:10,  3.26it/s]DDIM Sampler:  34%|███▍      | 17/50 [00:04<00:10,  3.26it/s]DDIM Sampler:  36%|███▌      | 18/50 [00:05<00:09,  3.25it/s]DDIM Sampler:  38%|███▊      | 19/50 [00:05<00:09,  3.25it/s]DDIM Sampler:  40%|████      | 20/50 [00:05<00:09,  3.25it/s]DDIM Sampler:  42%|████▏     | 21/50 [00:06<00:08,  3.25it/s]DDIM Sampler:  44%|████▍     | 22/50 [00:06<00:08,  3.24it/s]DDIM Sampler:  46%|████▌     | 23/50 [00:06<00:08,  3.24it/s]DDIM Sampler:  48%|████▊     | 24/50 [00:06<00:08,  3.24it/s]DDIM Sampler:  50%|█████     | 25/50 [00:07<00:07,  3.24it/s]DDIM Sampler:  52%|█████▏    | 26/50 [00:07<00:07,  3.24it/s]DDIM Sampler:  54%|█████▍    | 27/50 [00:07<00:07,  3.24it/s]DDIM Sampler:  56%|█████▌    | 28/50 [00:08<00:06,  3.24it/s]DDIM Sampler:  58%|█████▊    | 29/50 [00:08<00:06,  3.24it/s]DDIM Sampler:  60%|██████    | 30/50 [00:08<00:06,  3.24it/s]DDIM Sampler:  62%|██████▏   | 31/50 [00:09<00:05,  3.23it/s]DDIM Sampler:  64%|██████▍   | 32/50 [00:09<00:05,  3.23it/s]DDIM Sampler:  66%|██████▌   | 33/50 [00:09<00:05,  3.23it/s]DDIM Sampler:  68%|██████▊   | 34/50 [00:10<00:04,  3.23it/s]DDIM Sampler:  70%|███████   | 35/50 [00:10<00:04,  3.23it/s]DDIM Sampler:  72%|███████▏  | 36/50 [00:10<00:04,  3.23it/s]DDIM Sampler:  74%|███████▍  | 37/50 [00:11<00:04,  3.23it/s]DDIM Sampler:  76%|███████▌  | 38/50 [00:11<00:03,  3.23it/s]DDIM Sampler:  78%|███████▊  | 39/50 [00:11<00:03,  3.23it/s]DDIM Sampler:  80%|████████  | 40/50 [00:11<00:03,  3.23it/s]DDIM Sampler:  82%|████████▏ | 41/50 [00:12<00:02,  3.23it/s]DDIM Sampler:  84%|████████▍ | 42/50 [00:12<00:02,  3.23it/s]DDIM Sampler:  86%|████████▌ | 43/50 [00:12<00:02,  3.23it/s]DDIM Sampler:  88%|████████▊ | 44/50 [00:13<00:01,  3.23it/s]DDIM Sampler:  90%|█████████ | 45/50 [00:13<00:01,  3.23it/s]DDIM Sampler:  92%|█████████▏| 46/50 [00:13<00:01,  3.23it/s]DDIM Sampler:  94%|█████████▍| 47/50 [00:14<00:00,  3.23it/s]DDIM Sampler:  96%|█████████▌| 48/50 [00:14<00:00,  3.23it/s]DDIM Sampler:  98%|█████████▊| 49/50 [00:14<00:00,  3.23it/s]DDIM Sampler: 100%|██████████| 50/50 [00:15<00:00,  3.23it/s]DDIM Sampler: 100%|██████████| 50/50 [00:15<00:00,  3.33it/s]
Traceback (most recent call last):
  File "playground_real.py", line 120, in <module>
    save_image(final_image, \
  File "/home/s1/eugenebaek/anaconda3/envs/masa/lib/python3.8/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/s1/eugenebaek/anaconda3/envs/masa/lib/python3.8/site-packages/torchvision/utils.py", line 156, in save_image
    grid = make_grid(tensor, **kwargs)
  File "/home/s1/eugenebaek/anaconda3/envs/masa/lib/python3.8/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/s1/eugenebaek/anaconda3/envs/masa/lib/python3.8/site-packages/torchvision/utils.py", line 65, in make_grid
    raise TypeError(f"tensor or list of tensors expected, got {type(tensor)}")
TypeError: tensor or list of tensors expected, got <class 'PIL.Image.Image'>
